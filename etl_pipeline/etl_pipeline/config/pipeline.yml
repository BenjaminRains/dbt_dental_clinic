# Pipeline configuration for the dental clinic ETL pipeline
#
# UNTESTED TEMPLATE - NEEDS WORK
# ==============================
# This file is an untested template configuration with placeholder data.
#
# Current Status:
# - Configuration structure is comprehensive but untested
# - Many features may not be implemented yet
# - Email addresses, Slack channels, and other data are NOT REAL
# - Performance settings and monitoring may not be functional
# - This is a forward-looking template, not production configuration
#
# Issues to Address:
# - Test which configuration options actually work
# - Replace placeholder data with real values
# - Validate that all settings are supported by the codebase
# - Simplify configuration to match current implementation
# - Add proper documentation for each section
#
# TODO: Test, validate, and update this configuration template
# TODO: Replace placeholder data with real production values
# TODO: Document which features are implemented vs. planned

# General settings
general:
  pipeline_name: "dental_clinic_elt"
  environment: "production"
  timezone: "UTC"
  max_retries: 3
  retry_delay_seconds: 300
  batch_size: 5000  # Larger batches for nightly runs
  parallel_jobs: 2  # Fewer parallel jobs for manual execution

# Database connections
connections:
  # OpenDental source database (production OpenDental MySQL database)
  opendental_source:
    type: "mysql"
    pool_size: 5
    pool_timeout: 30
    pool_recycle: 3600
    connect_timeout: 60
    read_timeout: 300
    write_timeout: 300

  # OpenDental replication database (local MySQL replica for ETL processing)
  opendental_replication:
    type: "mysql"
    pool_size: 5
    pool_timeout: 30
    pool_recycle: 3600
    connect_timeout: 60
    read_timeout: 300
    write_timeout: 300

  # Analytics database - raw schema (PostgreSQL opendental_analytics.raw)
  opendental_analytics_raw:
    type: "postgresql"
    pool_size: 5
    pool_timeout: 30
    pool_recycle: 3600
    connect_timeout: 60
    read_timeout: 300
    write_timeout: 300
    schema: "raw"

  # Analytics database - public schema (PostgreSQL opendental_analytics.public)
  opendental_analytics_public:
    type: "postgresql"
    pool_size: 5
    pool_timeout: 30
    pool_recycle: 3600
    connect_timeout: 60
    read_timeout: 300
    write_timeout: 300
    schema: "public"

  # Analytics database - public_staging schema (PostgreSQL opendental_analytics.public_staging)
  opendental_analytics_staging:
    type: "postgresql"
    pool_size: 5
    pool_timeout: 30
    pool_recycle: 3600
    connect_timeout: 60
    read_timeout: 300
    write_timeout: 300
    schema: "public_staging"

  # Analytics database - public_intermediate schema (PostgreSQL opendental_analytics.public_intermediate)
  opendental_analytics_intermediate:
    type: "postgresql"
    pool_size: 5
    pool_timeout: 30
    pool_recycle: 3600
    connect_timeout: 60
    read_timeout: 300
    write_timeout: 300
    schema: "public_intermediate"

  # Analytics database - public_marts schema (PostgreSQL opendental_analytics.public_marts)
  opendental_analytics_marts:
    type: "postgresql"
    pool_size: 5
    pool_timeout: 30
    pool_recycle: 3600
    connect_timeout: 60
    read_timeout: 300
    write_timeout: 300
    schema: "public_marts"

# Pipeline stages
stages:
  extract:
    enabled: true
    timeout_minutes: 30
    error_threshold: 0.01  # 1% error rate threshold
    validation:
      enabled: true
      sample_size: 1000
      rules:
        - name: "row_count_check"
          threshold: 0.99  # 99% match required
        - name: "null_check"
          threshold: 0.95  # 95% non-null required

  load:
    enabled: true
    timeout_minutes: 45
    error_threshold: 0.01
    validation:
      enabled: true
      sample_size: 1000
      rules:
        - name: "data_type_check"
          threshold: 1.0  # 100% match required
        - name: "constraint_check"
          threshold: 1.0

  transform:
    enabled: true
    timeout_minutes: 60
    error_threshold: 0.01
    validation:
      enabled: true
      sample_size: 1000
      rules:
        - name: "business_rule_check"
          threshold: 1.0
        - name: "calculation_check"
          threshold: 0.99

# Monitoring and alerting
monitoring:
  metrics:
    collection_interval: 300  # 5 minutes (during pipeline runs)
    retention_days: 30
    storage_path: "metrics/"

  alerts:
    slack:
      enabled: true
      channel: "#dental-clinic-alerts"
      severity_levels:
        - error
        - warning
        - info

    email:
      enabled: true
      recipients:
        - "data-team@dentalclinic.com"
        - "oncall@dentalclinic.com"
      severity_levels:
        - error
        - warning

# Performance settings
performance:
  memory_limit_mb: 4096
  cpu_limit_percent: 80
  io_limit_mbps: 100
  temp_storage_gb: 10

# Logging configuration
logging:
  level: "INFO"
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
  file:
    enabled: true
    path: "logs/pipeline.log"
    max_size_mb: 100
    backup_count: 10
  console:
    enabled: true
    level: "INFO"

# Data retention
retention:
  staging:
    days: 7
    cleanup_schedule: "0 0 * * *"  # Daily at midnight
  target:
    days: 365
    cleanup_schedule: "0 0 1 * *"  # Monthly on the 1st

# Error handling
error_handling:
  max_consecutive_failures: 3
  failure_notification_threshold: 2
  auto_retry:
    enabled: true
    max_attempts: 3
    delay_minutes: 5
  error_logging:
    enabled: true
    path: "logs/errors.log"
    max_size_mb: 100
    backup_count: 10

# Security settings
security:
  encryption:
    enabled: true
    algorithm: "AES-256"
  ssl:
    enabled: true
    verify: true
  authentication:
    method: "token"
    token_expiry_hours: 24 