version: 2

sources:
  - name: opendental
    description: "OpenDental data in PostgreSQL"
    database: opendental_analytics
    schema: raw  # Raw data from ETL pipeline
    
    # Global settings for all tables
    loaded_at_field: "_loaded_at"
    freshness:
      warn_after: {count: 24, period: hour}
      error_after: {count: 720, period: hour}
    
    tables:
      - name: allergy
        description: "Patient allergy records containing allergy information including reactions and status"
        columns:
          - name: "AllergyNum"
            description: "Primary key - Unique identifier for each allergy record"
            tests:
              - unique_quoted
              - not_null_quoted
          - name: "AllergyDefNum"
            description: "Foreign key to allergy definitions table. References the specific type of allergy"
            tests:
              - not_null_quoted
          - name: "PatNum"
            description: "Foreign key to patient table. Identifies the patient who has the allergy"
            tests:
              - not_null_quoted
          - name: "Reaction"
            description: "Text description of the allergic reaction"
          - name: "IsActive"
            description: "Flag indicating if the allergy is currently active (1) or inactive (0)"
          - name: "DateTStamp"
            description: "Timestamp when the allergy record was last modified"
          - name: "AdverseReactionDate"
            description: "Date when the adverse reaction occurred"
          - name: "SnomedReaction"
            description: "SNOMED CT code for the allergic reaction"

      - name: allergydef
        description: "Allergy definitions containing information about different types of allergies and their related medication references"
        columns:
          - name: "AllergyDefNum"
            description: "Primary key - Unique identifier for each allergy definition"
            tests:
              - unique_quoted
              - not_null_quoted
          - name: "Description"
            description: "Description of the allergy definition"
          - name: "IsHidden"
            description: "Flag indicating if the allergy definition is hidden from view (0 = visible, 1 = hidden)"
            tests:
              - accepted_values_quoted:
                  values: [false, true]
          - name: "DateTStamp"
            description: "Timestamp of when the record was last updated"
            tests:
              - not_null_quoted
          - name: "SnomedType"
            description: "SNOMED CT (Systematized Nomenclature of Medicine -- Clinical Terms) type identifier"
          - name: "MedicationNum"
            description: "Foreign key reference to the related medication"
            tests:
              - not_null_quoted
          - name: "UniiCode"
            description: "Unique Ingredient Identifier (UNII) code for the allergen"

      - name: disease
        description: "Patient disease records containing disease history, including start/stop dates, status, and notes"
        columns:
          - name: "DiseaseNum"
            description: "Primary key - Unique identifier for each disease record"
            tests:
              - unique_quoted
              - not_null_quoted
          - name: "PatNum"
            description: "Foreign key to the patient table"
            tests:
              - not_null_quoted
          - name: "PatientNote"
            description: "Text notes related to the patient's specific disease condition"
          - name: "SnomedProblemType"
            description: "SNOMED CT classification code for the type of problem/disease"
          - name: "DateTStamp"
            description: "Timestamp when the record was created or last modified"
          - name: "DateStart"
            description: "Date when the disease/condition was first diagnosed or recorded"
          - name: "DateStop"
            description: "Date when the disease/condition was resolved or ended (if applicable)"
          - name: "ProblemStatus"
            description: "Numeric indicator of the problem's current status"
          - name: "FunctionStatus"
            description: "Numeric indicator of the patient's functional status related to this condition"

      - name: diseasedef
        description: "Disease definitions containing information about various diseases including their ICD9, ICD10, and SNOMED codes"
        columns:
          - name: "DiseaseDefNum"
            description: "Primary key of the disease definition table"
            tests:
              - unique_quoted
              - not_null_quoted
          - name: "DiseaseName"
            description: "The name or description of the disease"
            tests:
              - not_null_quoted
          - name: "ItemOrder"
            description: "Numerical value indicating the display order of the disease definition"
          - name: "IsHidden"
            description: "Flag indicating if the disease definition is hidden from view (0 = visible, 1 = hidden)"
          - name: "DateTStamp"
            description: "Timestamp of when the record was last updated"
            tests:
              - not_null_quoted
          - name: "Icd9Code"
            description: "International Classification of Diseases, 9th Revision (ICD-9) code for the disease"
          - name: "SnomedCode"
            description: "SNOMED CT (Systematized Nomenclature of Medicine -- Clinical Terms) code for the disease"
          - name: "Icd10Code"
            description: "International Classification of Diseases, 10th Revision (ICD-10) code for the disease"

      - name: medication
        description: "Medication definitions containing information about medications including their names, generic equivalents, and RxNorm codes"
        columns:
          - name: MedicationNum
            description: "Primary key - Unique identifier for each medication"
            tests:
              - unique_quoted
              - not_null_quoted
          - name: "MedName"
            description: "Name of the medication"
            tests:
              - not_null_quoted
          - name: "GenericNum"
            description: "Foreign key to the generic medication table"
          - name: "Notes"
            description: "Additional notes or information about the medication"
          - name: "DateTStamp"
            description: "Timestamp when the record was last modified"
            tests:
              - not_null_quoted
          - name: "RxCui"
            description: "RxNorm Concept Unique Identifier (RxCUI) for the medication"
            tests:
              - not_null_quoted

      - name: pharmclinic
        description: "Pharmacy-clinic relationships that map the associations between pharmacies and clinics"
        columns:
          - name: "PharmClinicNum"
            description: "Primary key - Unique identifier for each pharmacy-clinic relationship"
            tests:
              - unique_quoted
              - not_null_quoted
          - name: "PharmacyNum"
            description: "Foreign key to the pharmacy table"
            tests:
              - not_null_quoted
          - name: "ClinicNum"
            description: "Foreign key to the clinic table"
            tests:
              - not_null_quoted

      - name: pharmacy
        description: "Pharmacy data containing information about pharmacies including their contact details and locations"
        columns:
          - name: "PharmacyNum"
            description: "Primary key - Unique identifier for each pharmacy"
            tests:
              - unique_quoted
              - not_null_quoted
          - name: "PharmId"
            description: "External identifier for the pharmacy"
          - name: "StoreName"
            description: "Name of the pharmacy store"
            tests:
              - not_null_quoted
          - name: "Phone"
            description: "Contact phone number for the pharmacy"
          - name: "Fax"
            description: "Fax number for the pharmacy"
          - name: "Address"
            description: "Primary street address of the pharmacy"
          - name: "Address2"
            description: "Secondary address line (suite, unit, etc.) if applicable"
          - name: "City"
            description: "City where the pharmacy is located"
          - name: "State"
            description: "State where the pharmacy is located"
          - name: "Zip"
            description: "ZIP/Postal code of the pharmacy location"
          - name: "Note"
            description: "Additional notes or comments about the pharmacy"
          - name: "DateTStamp"
            description: "Timestamp of when the record was last updated"

      - name: rxdef
        description: "Prescription definitions containing standard drug information, instructions, and control status"
        columns:
          - name: RxDefNum
            description: "Primary key - Unique identifier for prescription definitions"
            tests:
              - unique_quoted
              - not_null_quoted
          - name: "Drug"
            description: "Name or description of the drug"
            tests:
              - not_null_quoted
          - name: "Sig"
            description: "Prescription instructions/signatura (how to take the medication)"
          - name: "Disp"
            description: "Dispensing instructions or quantity to dispense"
          - name: "Refills"
            description: "Number of refills allowed for the prescription"
          - name: "Notes"
            description: "Additional notes about the prescription"
          - name: "IsControlled"
            description: "Flag indicating if this is a controlled substance (0/1)"
            tests:
              - accepted_values_quoted:
                  values: [false, true]
          - name: "RxCui"
            description: "RxNorm Concept Unique Identifier for the drug"
          - name: "IsProcRequired"
            description: "Flag indicating if a procedure is required (0/1)"
            tests:
              - accepted_values_quoted:
                  values: [false, true]
          - name: "PatientInstruction"
            description: "Detailed instructions for the patient"

      - name: rxnorm
        description: "RxNorm medication reference data providing normalized names and identifiers for clinical drugs"
        columns:
          - name: RxNormNum
            description: "Primary key - Unique identifier for each RxNorm record"
            tests:
              - unique_quoted
              - not_null_quoted
          - name: "RxCui"
            description: "RxNorm Concept Unique Identifier - A unique identifier for a drug concept"
            tests:
              - not_null_quoted
          - name: "MmslCode"
            description: "MMSL (Multum MediSource Lexicon) code for the drug"
          - name: "Description"
            description: "Text description of the drug/medication"

      - name: rxpat
        description: "Patient prescriptions containing detailed prescription records including drug information, instructions, and e-prescription details"
        columns:
          - name: "RxNum"
            description: "Primary key - Unique identifier for each prescription"
            tests:
              - unique_quoted
              - not_null_quoted
          
          - name: "PatNum"
            description: "Foreign key to patient table identifying the patient receiving the prescription"
            tests:
              - not_null_quoted

          - name: "ProvNum"
            description: "Foreign key to provider table identifying the prescribing provider"

          - name: "PharmacyNum"
            description: "Foreign key to pharmacy table identifying the dispensing pharmacy"

          - name: "ProcNum"
            description: "Foreign key to procedure table linking to related dental procedure"

          - name: "ClinicNum"
            description: "Foreign key to clinic table identifying the prescribing clinic"

          - name: "UserNum"
            description: "Foreign key to user table identifying who created/modified the record"

          - name: "RxDate"
            description: "Date when the prescription was written"

          - name: "DateTStamp"
            description: "Timestamp of when the record was last modified"

          - name: "Drug"
            description: "Name of the prescribed medication"

          - name: "Sig"
            description: "Prescription instructions/signatura"

          - name: "Disp"
            description: "Instructions for dispensing the medication"

          - name: "Refills"
            description: "Number of authorized refills"

          - name: "Notes"
            description: "Additional notes about the prescription"

          - name: "IsControlled"
            description: "Boolean flag (smallint) indicating if medication is a controlled substance"

          - name: "SendStatus"
            description: "Status of prescription transmission"

          - name: "RxCui"
            description: "RxNorm Concept Unique Identifier for the medication"

          - name: "DosageCode"
            description: "Code indicating medication dosage"

          - name: "DaysOfSupply"
            description: "Number of days the prescription should last"

          - name: "PatientInstruction"
            description: "Detailed instructions for the patient"

          - name: "ErxGuid"
            description: "Globally unique identifier for electronic prescriptions"

          - name: "IsErxOld"
            description: "Boolean flag (smallint) indicating if this is an old electronic prescription"

          - name: "ErxPharmacyInfo"
            description: "Additional pharmacy information for electronic prescriptions"

          - name: "IsProcRequired"
            description: "Boolean flag (smallint) indicating if a procedure is required"

          - name: "RxType"
            description: "Type of prescription"
