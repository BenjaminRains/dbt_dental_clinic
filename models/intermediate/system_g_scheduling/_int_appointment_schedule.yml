version: 2

models:
  - name: int_appointment_schedule
    description: >
      Intermediate model for appointment scheduling.
      Provides a view of the appointment schedule per provider and day.
      Part of System G: Scheduling
    columns:
      - name: schedule_id
        description: Unique identifier for the schedule record
        tests:
          - unique
          - not_null
      - name: schedule_date
        description: Date of the schedule
        tests:
          - not_null
          - dbt_utils.date_after:
              datepart: day
              field: schedule_date
              interval: -90
      - name: provider_id
        description: ID of the provider
        tests:
          - not_null
          - relationships:
              to: ref('stg_opendental__provider')
              field: provider_id
      - name: provider_name
        description: Name of the provider
        tests:
          - not_null
      - name: total_appointments
        description: Total number of appointments scheduled
        tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: ">= 0"
      - name: completed_appointments
        description: Number of completed appointments
        tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: ">= 0"
          - dbt_utils.expression_is_true:
              expression: "<= total_appointments"
      - name: cancelled_appointments
        description: Number of cancelled appointments
        tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: ">= 0"
          - dbt_utils.expression_is_true:
              expression: "<= total_appointments"
      - name: no_show_appointments
        description: Number of no-show appointments
        tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: ">= 0"
          - dbt_utils.expression_is_true:
              expression: "<= total_appointments"
      - name: unconfirmed_appointments
        description: Number of unconfirmed appointments
        tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: ">= 0"
          - dbt_utils.expression_is_true:
              expression: "<= total_appointments"
      - name: total_appointment_minutes
        description: Total scheduled appointment minutes
        tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: ">= 0"
      - name: available_minutes
        description: Total available minutes in the schedule
        tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: ">= 0"
      - name: utilization_rate
        description: Percentage of available time utilized for appointments
        tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: ">= 0"
          - dbt_utils.expression_is_true:
              expression: "<= 100"
      - name: start_time
        description: Start time of the schedule
      - name: end_time
        description: End time of the schedule
      - name: is_day_off
        description: Flag indicating if this is a day off
        tests:
          - not_null
      - name: model_created_at
        description: Timestamp when this record was created in the dbt model
        tests:
          - not_null
      - name: model_updated_at
        description: Timestamp when this record was last updated in the dbt model
        tests:
          - not_null
