version: 2

models:
  - name: int_task_management
    description: >
      Intermediate model for task management.
      Provides a comprehensive view of tasks, their history, and associated metadata.
      Integrates with the appointment scheduling system to track tasks related to appointments.
      Part of System G: Scheduling
    columns:
      - name: task_id
        description: Unique identifier for the task
        tests:
          - unique
          - not_null
      - name: task_list_id
        description: ID of the task list this task belongs to
        tests:
          - not_null
          - relationships:
              to: ref('stg_opendental__tasklist')
              field: task_id
      - name: key_id
        description: Reference ID for the associated entity (e.g., appointment_id)
      - name: from_id
        description: ID of the entity that created the task
      - name: assigned_user_id
        description: ID of the user assigned to the task
        tests:
          - relationships:
              to: ref('stg_opendental__user')
              field: user_id
      - name: priority_def_id
        description: ID of the priority definition
      - name: triage_category_id
        description: ID of the triage category
      - name: task_date
        description: Date when the task is due
        tests:
          - not_null
      - name: entry_timestamp
        description: When the task was created
        tests:
          - not_null
      - name: finished_timestamp
        description: When the task was completed
        tests:
          - dbt_utils.expression_is_true:
              expression: "finished_timestamp IS NULL OR finished_timestamp >= entry_timestamp"
      - name: original_timestamp
        description: Original creation timestamp
        tests:
          - not_null
      - name: last_edit_timestamp
        description: Last modification timestamp
        tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: "last_edit_timestamp >= original_timestamp"
      
      # Task List Information
      - name: task_list_description
        description: Description of the task list
      - name: parent_task_list_id
        description: ID of the parent task list
      - name: task_list_date
        description: Date associated with the task list
      - name: is_repeating
        description: Whether the task list repeats
        tests:
          - not_null
      - name: date_type
        description: Type of date for the task list
      - name: task_list_from_id
        description: ID of the entity that created the task list
      - name: object_type
        description: Type of object associated with the task list
      - name: task_list_entry_datetime
        description: When the task list was created
      - name: global_task_filter_type
        description: Type of global filter for the task list
      - name: task_list_status
        description: Status of the task list
      
      # Latest Task History
      - name: latest_history_id
        description: ID of the latest history record
      - name: latest_history_timestamp
        description: Timestamp of the latest history record
      - name: latest_task_status
        description: Latest status of the task
      - name: latest_description
        description: Latest description of the task
      - name: latest_is_repeating
        description: Latest repeating status
      - name: latest_date_type
        description: Latest date type
      - name: latest_object_type
        description: Latest object type
      - name: latest_entry_datetime
        description: Latest entry datetime
      - name: latest_finished_datetime
        description: Latest finished datetime
      - name: reminder_group_id
        description: ID of the reminder group
      - name: reminder_type
        description: Type of reminder
      - name: reminder_frequency
        description: Frequency of reminders
      - name: latest_original_datetime
        description: Latest original datetime
      - name: latest_description_override
        description: Latest description override
      - name: latest_is_read_only
        description: Latest read-only status
      
      # Latest Task Note
      - name: latest_note_id
        description: ID of the latest note
      - name: latest_note_datetime
        description: Timestamp of the latest note
      - name: latest_note
        description: Content of the latest note
      
      # Subscription Information
      - name: task_subscription_id
        description: ID of the task subscription
      - name: subscriber_user_id
        description: ID of the subscribing user
      
      # Unread Status
      - name: task_unread_id
        description: ID of the unread record
      - name: unread_user_id
        description: ID of the user who hasn't read the task 