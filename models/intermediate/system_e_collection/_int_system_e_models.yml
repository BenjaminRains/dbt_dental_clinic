version: 2

models:
  - name: int_collection_campaigns
    description: >
      Intermediate model for collection campaigns. 
      Tracks organized collection efforts targeting specific patient groups.
      Part of System E: Collections
    columns:
      - name: campaign_id
        description: Unique identifier for the collection campaign
        tests:
          - unique
          - not_null
      - name: campaign_name
        description: Name of the collection campaign
      - name: campaign_description
        description: Detailed description of the campaign
      - name: start_date
        description: Date when the collection campaign started
      - name: end_date
        description: Date when the collection campaign is scheduled to end or ended
      - name: target_ar_balance_min
        description: Minimum AR balance threshold for accounts in this campaign
      - name: target_ar_balance_max
        description: Maximum AR balance threshold for accounts in this campaign
      - name: target_aging_min
        description: Minimum aging days for accounts in this campaign
      - name: target_aging_max
        description: Maximum aging days for accounts in this campaign
      - name: priority
        description: Priority level of the campaign (high, medium, low)
      - name: campaign_status
        description: Status of the campaign (planned, active, completed, canceled)
      - name: assigned_user_id
        description: ID of the user assigned to manage this campaign
      - name: total_accounts
        description: Total number of accounts in this campaign
      - name: total_ar_amount
        description: Total AR amount targeted by this campaign
      - name: collected_amount
        description: Amount collected so far from this campaign
      - name: collection_rate
        description: Percentage of targeted amount that has been collected
      - name: created_at
        description: Timestamp when the campaign was created
      - name: updated_at
        description: Timestamp when the campaign was last updated
      - name: model_created_at
        description: Timestamp when this record was last created in the dbt model
      - name: model_updated_at
        description: Timestamp when this record was last updated in the dbt model

  - name: int_collection_tasks
    description: >
      Intermediate model for collection tasks.
      Tracks individual collection actions/tasks related to campaigns.
      Part of System E: Collections
    columns:
      - name: collection_task_id
        description: Unique identifier for the collection task
        tests:
          - unique
          - not_null
      - name: campaign_id
        description: Foreign key to int_collection_campaigns
      - name: task_id
        description: Foreign key to stg_opendental__task
      - name: patient_id
        description: Foreign key to stg_opendental__patient
      - name: assigned_user_id
        description: ID of the user assigned to this task
      - name: task_type
        description: Type of collection task (call, email, letter, etc.)
      - name: task_description
        description: Detailed description of the task
      - name: due_date
        description: Date when the task is due
      - name: completion_date
        description: Date when the task was completed
      - name: task_status
        description: Status of the task (pending, in_progress, completed, canceled)
      - name: priority
        description: Priority level of the task (high, medium, low)
      - name: ar_balance_at_creation
        description: AR balance of the account when the task was created
      - name: aging_bucket_at_creation
        description: Aging bucket of the account when the task was created
      - name: outcome
        description: Outcome of the collection task (successful, unsuccessful, partial)
      - name: promised_payment_amount
        description: Amount that the patient promised to pay
      - name: promised_payment_date
        description: Date when the patient promised to make the payment
      - name: actual_payment_amount
        description: Actual payment amount received (if any)
      - name: actual_payment_date
        description: Date when the actual payment was received
      - name: follow_up_required
        description: Flag indicating if follow-up is required
      - name: follow_up_date
        description: Date when follow-up is scheduled
      - name: follow_up_task_id
        description: ID of the follow-up task (if any)
      - name: notes
        description: Additional notes about the task
      - name: model_created_at
        description: Timestamp when this record was last created in the dbt model
      - name: model_updated_at
        description: Timestamp when this record was last updated in the dbt model

  - name: int_collection_communication
    description: >
      Intermediate model for collection communications.
      Tracks all communications related to collection efforts.
      Part of System E: Collections
    columns:
      - name: collection_communication_id
        description: Unique identifier for the collection communication
        tests:
          - unique
          - not_null
      - name: campaign_id
        description: Foreign key to int_collection_campaigns
      - name: collection_task_id
        description: Foreign key to int_collection_tasks
      - name: commlog_id
        description: Foreign key to stg_opendental__commlog
      - name: patient_id
        description: Foreign key to stg_opendental__patient
      - name: user_id
        description: ID of the user who initiated the communication
      - name: communication_date
        description: Date when the communication occurred
      - name: communication_type
        description: Type of communication (call, email, letter, text, etc.)
      - name: direction
        description: Direction of communication (outbound, inbound)
      - name: status
        description: Status of the communication (sent, received, failed, etc.)
      - name: template_id
        description: ID of the template used (if any)
      - name: subject
        description: Subject of the communication
      - name: message_content
        description: Content of the communication
      - name: patient_response
        description: Response from the patient
      - name: outcome
        description: Outcome of the communication (successful, unsuccessful, partial)
      - name: promised_payment_amount
        description: Amount that the patient promised to pay
      - name: promised_payment_date
        description: Date when the patient promised to make the payment
      - name: actual_payment_amount
        description: Actual payment amount received (if any)
      - name: actual_payment_date
        description: Date when the actual payment was received
      - name: follow_up_required
        description: Flag indicating if follow-up is required
      - name: follow_up_date
        description: Date when follow-up is scheduled
      - name: follow_up_task_id
        description: ID of the follow-up task (if any)
      - name: notes
        description: Additional notes about the communication
      - name: model_created_at
        description: Timestamp when this record was last created in the dbt model
      - name: model_updated_at
        description: Timestamp when this record was last updated in the dbt model

  - name: int_collection_metrics
    description: >
      Intermediate model for collection metrics.
      Tracks performance metrics for collection efforts.
      Part of System E: Collections
    columns:
      - name: metric_id
        description: Unique identifier for the collection metric
        tests:
          - unique
          - not_null
      - name: snapshot_date
        description: Date of the metrics snapshot
      - name: campaign_id
        description: Foreign key to int_collection_campaigns (null for overall metrics)
      - name: user_id
        description: ID of the user (null for campaign or overall metrics)
      - name: metric_level
        description: Level of the metric (overall, campaign, user)
      - name: total_accounts
        description: Total number of accounts in collection
      - name: total_ar_amount
        description: Total AR amount in collection
      - name: collected_amount
        description: Amount collected so far
      - name: collection_rate
        description: Percentage of targeted amount that has been collected
      - name: accounts_contacted
        description: Number of accounts contacted
      - name: contact_rate
        description: Percentage of accounts that have been contacted
      - name: promised_payment_amount
        description: Total amount of payments promised
      - name: promised_payment_count
        description: Count of promised payments
      - name: payment_fulfillment_rate
        description: Percentage of promised payments that were fulfilled
      - name: payment_punctuality_rate
        description: Percentage of promised payments that were made on time
      - name: avg_days_to_payment
        description: Average number of days from promise to payment
      - name: avg_contacts_per_payment
        description: Average number of contacts required to secure a payment
      - name: tasks_completed
        description: Number of collection tasks completed
      - name: tasks_pending
        description: Number of collection tasks pending
      - name: communications_sent
        description: Number of communications sent
      - name: communications_received
        description: Number of communications received
      - name: model_created_at
        description: Timestamp when this record was last created in the dbt model
      - name: model_updated_at
        description: Timestamp when this record was last updated in the dbt model

  - name: int_billing_statements
    description: >
      Intermediate model for billing statements.
      Tracks statements sent to patients and their effectiveness in collections.
      Part of System E: Collections
    columns:
      - name: billing_statement_id
        description: Unique identifier for the billing statement record
        tests:
          - unique
          - not_null
      - name: statement_id
        description: Foreign key to stg_opendental__statement
      - name: patient_id
        description: Foreign key to stg_opendental__patient
      - name: date_sent
        description: Date when the statement was sent
        tests:
          - not_null
      - name: date_range_from
        description: Start date of the statement period
      - name: date_range_to
        description: End date of the statement period
      - name: balance_total
        description: Total balance on the statement
      - name: insurance_estimate
        description: Estimated insurance portion
      - name: mode
        description: Delivery mode code
      - name: delivery_method
        description: Statement delivery method (Mail, Email, SMS, etc.)
      - name: is_sent
        description: Flag indicating if the statement was actually sent
      - name: is_receipt
        description: Flag indicating if this is a receipt
      - name: is_invoice
        description: Flag indicating if this is an invoice
      - name: statement_type
        description: Type of statement
      - name: sms_send_status
        description: Status of SMS delivery
      - name: patient_name
        description: Name of the patient
      - name: total_balance
        description: Total AR balance for the patient
      - name: balance_0_30_days
        description: Patient balance in 0-30 day aging bucket
      - name: balance_31_60_days
        description: Patient balance in 31-60 day aging bucket
      - name: balance_61_90_days
        description: Patient balance in 61-90 day aging bucket
      - name: balance_over_90_days
        description: Patient balance in over 90 day aging bucket
      - name: item_count
        description: Number of items on the statement
      - name: procedure_count
        description: Number of procedures on the statement
      - name: adjustment_count
        description: Number of adjustments on the statement
      - name: payment_count
        description: Number of payments on the statement
      - name: campaign_id
        description: Foreign key to int_collection_campaigns if applicable
      - name: campaign_name
        description: Name of the collection campaign if applicable
      - name: campaign_status
        description: Status of the collection campaign if applicable
      - name: sent_during_campaign
        description: Flag indicating if statement was sent during an active campaign
      - name: payment_amount_7days
        description: Amount paid within 7 days of statement
      - name: payment_amount_14days
        description: Amount paid within 14 days of statement
      - name: payment_amount_30days
        description: Amount paid within 30 days of statement
      - name: payment_count_30days
        description: Number of payments within 30 days of statement
      - name: payment_ratio_30days
        description: Ratio of payment amount to statement balance within 30 days
      - name: is_collection_statement
        description: Flag indicating if this is a collection-related statement
      - name: resulted_in_payment
        description: Flag indicating if statement resulted in a payment
      - name: payment_result
        description: Outcome of statement (full_payment, partial_payment, no_payment)
      - name: model_created_at
        description: Timestamp when this record was created in the dbt model
      - name: model_updated_at
        description: Timestamp when this record was last updated in the dbt model

  - name: int_statement_metrics
    description: >
      Intermediate model for statement metrics.
      Provides aggregated metrics on statement effectiveness for collections.
      Part of System E: Collections
    columns:
      - name: statement_metric_id
        description: Unique identifier for the statement metric
        tests:
          - unique
          - not_null
      - name: snapshot_date
        description: Date of the metrics snapshot
      - name: metric_type
        description: Type of metric grouping (overall, by_delivery_method, by_campaign)
      - name: delivery_method
        description: Statement delivery method (for by_delivery_method metrics)
      - name: campaign_id
        description: Campaign ID (for by_campaign metrics)
      - name: total_statements
        description: Total number of statements analyzed
      - name: collection_statements
        description: Number of collection-related statements
      - name: collection_statement_ratio
        description: Ratio of collection statements to total statements
        tests:
          - test_name: valid_collection_efficiency
            column_name: collection_statement_ratio
      - name: total_balance
        description: Total balance amount on statements
      - name: collection_balance
        description: Total balance amount on collection statements
      - name: payment_amount_7days
        description: Total payments received within 7 days of statements
      - name: payment_amount_14days
        description: Total payments received within 14 days of statements
      - name: payment_amount_30days
        description: Total payments received within 30 days of statements
      - name: statements_with_payment
        description: Number of statements that resulted in payments
      - name: statements_with_full_payment
        description: Number of statements that resulted in full payment
      - name: statements_with_partial_payment
        description: Number of statements that resulted in partial payment
      - name: statement_payment_rate
        description: Percentage of statements that resulted in any payment
        tests:
          - test_name: valid_collection_efficiency
            column_name: statement_payment_rate
      - name: collection_payment_rate
        description: Percentage of collection statements that resulted in payment
        tests:
          - test_name: valid_collection_efficiency
            column_name: collection_payment_rate
      - name: balance_collection_rate_30days
        description: Percentage of total balance collected within 30 days
        tests:
          - test_name: valid_collection_efficiency
            column_name: balance_collection_rate_30days
      - name: collection_balance_rate_30days
        description: Percentage of collection balance collected within 30 days
        tests:
          - test_name: valid_collection_efficiency
            column_name: collection_balance_rate_30days
      - name: full_payment_rate
        description: Percentage of payments that were full payments
        tests:
          - test_name: valid_collection_efficiency
            column_name: full_payment_rate
      - name: day7_response_ratio
        description: Ratio of 7-day payments to 30-day payments
      - name: model_created_at
        description: Timestamp when this record was created in the dbt model
      - name: model_updated_at
        description: Timestamp when this record was last updated in the dbt model