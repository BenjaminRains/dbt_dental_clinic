# system b models. 

version: 2

models:
  - name: int_insurance_coverage
    description: >
      Comprehensive insurance coverage information combining plan details, subscriber information,
      carrier details, and verification status. This model serves as the foundation for insurance-related
      analytics and reporting.
    columns:
      - name: insurance_plan_id
        description: Primary key for the insurance plan
        tests:
          - not_null
          - unique
      - name: patient_id
        description: Foreign key to the patient
        tests:
          - not_null
          - relationships:
              to: ref('stg_opendental__patient')
              field: patient_id
      - name: carrier_id
        description: Foreign key to the insurance carrier
        tests:
          - not_null
          - relationships:
              to: ref('stg_opendental__carrier')
              field: carrier_id
      - name: subscriber_id
        description: Foreign key to the insurance subscriber
        tests:
          - not_null
          - relationships:
              to: ref('stg_opendental__inssub')
              field: subscriber_id
      - name: plan_type
        description: Type of insurance plan (e.g., PPO, HMO)
        tests:
          - not_null
      - name: group_number
        description: Insurance group number
      - name: group_name
        description: Insurance group name
      - name: verification_status
        description: Current verification status of the insurance
        tests:
          - not_null
      - name: verification_date
        description: Date of last verification
      - name: benefit_details
        description: JSON containing benefit details from stg_opendental__benefit
      - name: is_active
        description: Whether the insurance coverage is currently active
        tests:
          - not_null
      - name: effective_date
        description: Date when the insurance coverage became effective
      - name: termination_date
        description: Date when the insurance coverage was terminated (if applicable)
      - name: created_at
        description: Timestamp when the record was created
        tests:
          - not_null
      - name: updated_at
        description: Timestamp when the record was last updated
        tests:
          - not_null

  - name: int_claim_details
    description: >
      Detailed claim information including procedures, payments, and tracking status.
      This model provides a comprehensive view of the insurance claim lifecycle.
    columns:
      - name: claim_id
        description: Primary key for the claim
        tests:
          - not_null
          - unique
      - name: insurance_plan_id
        description: Foreign key to the insurance plan
        tests:
          - not_null
          - relationships:
              to: ref('int_insurance_coverage')
              field: insurance_plan_id
      - name: patient_id
        description: Foreign key to the patient
        tests:
          - not_null
          - relationships:
              to: ref('stg_opendental__patient')
              field: patient_id
      - name: procedure_id
        description: Foreign key to the procedure
        tests:
          - not_null
          - relationships:
              to: ref('stg_opendental__procedurelog')
              field: procedure_id
      - name: claim_status
        description: Current status of the claim
        tests:
          - not_null
      - name: claim_type
        description: Type of claim (e.g., primary, secondary)
        tests:
          - not_null
      - name: claim_date
        description: Date when the claim was created
        tests:
          - not_null
      - name: procedure_code
        description: Procedure code for the claim
        tests:
          - not_null
      - name: procedure_description
        description: Description of the procedure
      - name: billed_amount
        description: Amount billed to insurance
        tests:
          - not_null
      - name: allowed_amount
        description: Amount allowed by insurance
      - name: paid_amount
        description: Amount paid by insurance
      - name: write_off_amount
        description: Amount written off
      - name: patient_responsibility
        description: Amount patient is responsible for
      - name: tracking_status
        description: Current tracking status of the claim
      - name: last_tracking_date
        description: Date of last tracking status update
      - name: created_at
        description: Timestamp when the record was created
        tests:
          - not_null
      - name: updated_at
        description: Timestamp when the record was last updated
        tests:
          - not_null 