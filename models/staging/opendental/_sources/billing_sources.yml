# =========== BILLING & PAYMENTS ===========
version: 2

sources:
  - name: opendental
    description: "OpenDental data in PostgreSQL"
    database: opendental_analytics
    schema: public  # PostgreSQL schema
    tables:
      - name: payment
        description: "Patient payments for services"
        loaded_at_field: "SecDateTEdit"  # Add freshness tracking
        freshness:
          warn_after: {count: 24, period: hour}
          error_after: {count: 48, period: hour}
        meta:
          data_quality_results:
            last_tested: '2024-03-14'
            tests_passed: 8
            tests_total: 8
            quality_checks:
              - test: "unique_payment_id"
                status: "pass"
              - test: "not_null_critical_fields"
                status: "pass"
                fields: ["payment_id", "patient_id", "payment_amount", "payment_date", "payment_type_id"]
              - test: "payment_type_validation"
                status: "pass"
                valid_values: [0, 69, 70, 71, 72, 391, 412, 417, 574, 634]
                description: "Payment types validated with warning severity for flexibility"
              - test: "payment_validation_rules"
                status: "pass"
      
      - name: payperiod
        description: "Payment period information"
        loaded_at_field: "SecDateTEdit"
      
      - name: payplan
        description: "Payment plans for spreading costs over time"
        loaded_at_field: "SecDateTEdit"
      
      - name: paysplit
        description: "Payment splits across procedures"
        loaded_at_field: "SecDateTEdit"
      
      - name: statement
        description: "Patient billing statements"
        loaded_at_field: "SecDateTEdit"
      
      - name: statementprod
        description: "Statement production data"
        loaded_at_field: "SecDateTEdit"
      
      - name: famaging
        description: "Family aging for accounts receivable"
        loaded_at_field: "SecDateTEdit"
      
      - name: fee
        description: "Fee amounts for procedures"
        loaded_at_field: "SecDateTEdit"
      
      - name: feesched
        description: "Fee schedules"
        loaded_at_field: "SecDateTEdit"
      
      - name: feeschedgroup
        description: "Groupings of fee schedules"
        loaded_at_field: "SecDateTEdit"